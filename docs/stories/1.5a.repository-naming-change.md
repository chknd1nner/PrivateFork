# Story 1.5a: Repository Naming Change - Remove "-private" Suffix

## Status
Approved

## Story
**As a** user,
**I want** the private fork to use the original repository name instead of appending "-private" to it,
**so that** the private repository has a cleaner, more intuitive name while still being identifiable as a private fork.

## Acceptance Criteria
1. The private repository name should match the original repository name exactly (e.g., "myproject" instead of "user-myproject-private").
2. Repository name collision detection must be implemented to handle cases where a repository with the same name already exists.
3. When a name collision is detected, the user must be prompted with options to resolve the conflict.
4. The repository description must clearly identify it as a private fork to maintain clarity about its purpose.
5. All error handling and cleanup logic must account for the new naming convention.
6. All unit tests expecting the "-private" suffix must be updated to reflect the new naming logic.

## Priority Risk Assessment

### HIGH RISK: Repository Name Conflicts
- **Impact**: Application failure if repository name already exists
- **Mitigation**: Enhanced collision detection with user prompts for resolution
- **Required Changes**: Update GitHubService collision detection logic

### MEDIUM RISK: Error Handling Logic Updates  
- **Impact**: Inconsistent error messages and cleanup procedures
- **Mitigation**: Review all error messages and cleanup logic for naming assumptions
- **Required Changes**: Update GitHubService cleanup methods

### MEDIUM RISK: Repository Description Updates
- **Impact**: Loss of identification that repository is a private fork
- **Mitigation**: Update description template to clearly identify private fork status
- **Required Changes**: Update description generation in PrivateForkOrchestrator

### MEDIUM RISK: Unit Test Updates
- **Impact**: Test failures due to changed naming expectations
- **Mitigation**: Systematic update of all tests expecting "-private" suffix
- **Required Changes**: Update test assertions and mock data

### LOW RISK: User Confusion
- **Impact**: Users may not immediately recognize private forks
- **Mitigation**: Clear repository description and consistent identification patterns
- **Required Changes**: Enhanced repository description templates

## Tasks / Subtasks

### Core Naming Logic Changes
- [ ] Update PrivateForkOrchestrator.swift naming logic (AC: 1)
  - [ ] Modify line 39 in PrivateForkOrchestrator.swift to use original repo name: `let privateRepoName = repoInfo.repo`
  - [ ] Update repository description to clearly identify as private fork: `"Private fork of \(repoInfo.owner)/\(repoInfo.repo)"`
  - [ ] Ensure parseRepositoryURL() correctly extracts repo name for new logic
  - [ ] Validate that local directory naming remains consistent with original repo name

### Enhanced Collision Detection (AC: 2, 3)
- [ ] Implement comprehensive collision detection in GitHubService
  - [ ] Review current validateRepositoryDoesNotExist() method for robustness
  - [ ] Add user prompt mechanism for collision resolution options
  - [ ] Implement collision resolution strategies:
    - [ ] Option 1: Append timestamp suffix (e.g., "myproject-20250723")
    - [ ] Option 2: Append incremental number (e.g., "myproject-2", "myproject-3")
    - [ ] Option 3: Allow user to provide custom name
    - [ ] Option 4: Cancel operation
  - [ ] Add collision detection to PrivateForkOrchestratorProtocol if needed
  - [ ] Update error handling for repositoryNameConflict scenarios

### Repository Description Enhancement (AC: 4)
- [ ] Update repository description template in PrivateForkOrchestrator
  - [ ] Change description from generic to clearly identify private fork status
  - [ ] Add original repository URL reference for clarity
  - [ ] Consider adding creation timestamp for tracking
  - [ ] Ensure description follows GitHub best practices for length and content

### Error Handling and Cleanup Updates (AC: 5)
- [ ] Review GitHubService cleanup logic for naming assumptions
  - [ ] Update performCleanup() method in PrivateForkOrchestrator for new naming
  - [ ] Review error messages for references to "-private" suffix
  - [ ] Update GitHubServiceError cases if needed for collision handling
  - [ ] Ensure PrivateForkError enum covers new collision scenarios
  - [ ] Test cleanup logic with new repository names

### Comprehensive Test Updates (AC: 6)
- [ ] Update PrivateForkOrchestratorTests.swift
  - [ ] Remove all expectations for "-private" suffix in repository names
  - [ ] Update test assertions to expect original repository names
  - [ ] Add tests for collision detection scenarios
  - [ ] Add tests for collision resolution options
  - [ ] Update mock data to reflect new naming convention
- [ ] Update GitHubServiceTests.swift  
  - [ ] Update repository creation tests for new naming
  - [ ] Add comprehensive collision detection test scenarios
  - [ ] Update cleanup and error handling tests
- [ ] Update MainViewModelTests.swift
  - [ ] Update integration tests for new repository naming
  - [ ] Add user interaction tests for collision resolution
- [ ] Update any UI tests referencing repository names
  - [ ] Search for hardcoded "-private" expectations in UI tests
  - [ ] Update test data and assertions

### UI Integration for Collision Resolution (AC: 3)
- [ ] Design user prompt interface for collision resolution
  - [ ] Create collision resolution dialog/sheet
  - [ ] Implement user choice handling in MainViewModel
  - [ ] Add progress indicators for collision checking
  - [ ] Ensure proper error display for collision scenarios
- [ ] Update MainViewModel for collision handling
  - [ ] Add collision resolution state management
  - [ ] Implement user choice processing logic
  - [ ] Update status callback messages for collision scenarios

## Dev Notes

### Current Implementation Analysis
Based on dev James' analysis, the primary change is in PrivateForkOrchestrator.swift:39 where the naming logic currently creates:
```swift
let privateRepoName = "\(repoInfo.owner)-\(repoInfo.repo)-private"
```

This should be changed to:
```swift
let privateRepoName = repoInfo.repo
```

### Risk Mitigation Strategy

**Repository Name Conflicts (HIGH RISK)**
The existing GitHubService.validateRepositoryDoesNotExist() method provides collision detection, but we need to enhance it with user resolution options. The current implementation returns a .repositoryNameConflict error, which should trigger a user prompt rather than immediate failure.

**Error Handling Logic (MEDIUM RISK)**  
All error messages and cleanup procedures that reference repository names need to be reviewed. The performCleanup() method in PrivateForkOrchestrator specifically uses privateRepo.name for deletion, which will work with the new naming but needs verification.

**Unit Test Dependencies (MEDIUM RISK)**
Current tests may have hardcoded expectations for the "-private" suffix. A systematic search and update of all test files is required to ensure compatibility with the new naming convention.

### Implementation Sequence
1. **Start with Core Logic**: Update PrivateForkOrchestrator naming logic first
2. **Enhance Collision Detection**: Implement robust collision detection and resolution
3. **Update Tests**: Systematically update all tests to match new expectations  
4. **UI Integration**: Add user interface for collision resolution
5. **Validation**: End-to-end testing with collision scenarios

### Technical Requirements

**Collision Detection Enhancement**
```swift
// Enhanced collision detection with resolution options
enum CollisionResolutionStrategy {
    case appendTimestamp
    case appendNumber(Int)
    case customName(String)
    case cancel
}

protocol CollisionResolverProtocol {
    func resolveNameCollision(
        originalName: String,
        strategy: CollisionResolutionStrategy
    ) async -> Result<String, GitHubServiceError>
}
```

**User Interface Integration**
The MainViewModel will need collision resolution state management:
```swift
@Published var showingCollisionResolution = false
@Published var collisionResolutionOptions: [CollisionResolutionStrategy] = []
```

### Component Standards Compliance
- **Protocol-Oriented Programming**: New collision resolution logic must be abstracted behind protocols
- **Dependency Injection**: Collision resolver should be injectable for testing
- **Asynchronous Operations**: All collision resolution must use async/await
- **Result Type**: All collision operations must return Result<Success, Error>
- **@MainActor**: UI state management must remain on main actor

### Testing Requirements
- **Unit Tests**: Collision detection and resolution logic
- **Integration Tests**: End-to-end workflow with collision scenarios
- **UI Tests**: User interaction with collision resolution interface
- **Edge Cases**: Multiple collisions, network failures during collision checks
- **Performance**: Collision detection should not significantly impact workflow speed

### File List
#### Files to Modify:
- `PrivateFork/Services/Implementations/PrivateForkOrchestrator.swift` (line 39 + description)
- `PrivateFork/Services/Implementations/GitHubService.swift` (collision detection enhancement)
- `PrivateFork/ViewModels/MainViewModel.swift` (collision resolution UI state)
- `PrivateForkTests/Services/PrivateForkOrchestratorTests.swift` (naming expectations)
- `PrivateForkTests/Services/GitHubServiceTests.swift` (collision scenarios)
- `PrivateForkTests/ViewModels/MainViewModelTests.swift` (integration tests)
- `PrivateForkUITests/PrivateForkUITests.swift` (if repository names referenced)

#### Files to Create:
- `PrivateFork/Services/Protocols/CollisionResolverProtocol.swift` (new collision resolution protocol)
- `PrivateFork/Services/Implementations/CollisionResolver.swift` (collision resolution logic)
- `PrivateFork/Views/CollisionResolutionSheet.swift` (user interface for collision resolution)
- `PrivateForkTests/Services/CollisionResolverTests.swift` (collision resolution tests)
- `PrivateForkTests/Mocks/MockCollisionResolver.swift` (mock for testing)

## Completion Criteria
- [ ] All repository names use original names without "-private" suffix
- [ ] Collision detection handles all edge cases with user prompts
- [ ] Repository descriptions clearly identify private fork status
- [ ] All tests pass with updated naming expectations
- [ ] Error handling and cleanup work correctly with new naming
- [ ] UI provides clear collision resolution options
- [ ] End-to-end testing validates complete workflow
- [ ] Performance impact is minimal (< 2 second delay for collision checks)

## Change Log
- **2025-07-23**: Initial story creation based on dev James' analysis
- **Priority**: High (addresses critical user experience improvement)
- **Epic**: Epic 1 - Core Private Fork Utility
- **Dependencies**: Story 1.5 (GUI and Core Logic Integration) must be completed

---

*This story addresses the critical user feedback that the "-private" suffix creates unnecessarily long and confusing repository names. The implementation focuses on risk mitigation through robust collision detection and comprehensive testing to ensure a smooth user experience.*